<?xml version="1.0" encoding="UTF-8"?>
<!-- 
/*
 *                  Eoulsan development code
 *
 * This code may be freely distributed and modified under the
 * terms of the GNU Lesser General Public License version 2.1 or
 * later and CeCILL-C. This should be distributed with the code.
 * If you do not have a copy, see:
 *
 *      http://www.gnu.org/licenses/lgpl-2.1.txt
 *      http://www.cecill.info/licences/Licence_CeCILL-C_V1-en.txt
 *
 * Copyright for this code is held jointly by the Genomic platform
 * of the Institut de Biologie de l'École Normale Supérieure and
 * the individual authors. These should be listed in @author doc
 * comments.
 *
 * For more information on the Eoulsan project and its aims,
 * or to join the Eoulsan Google group, visit the home page
 * at:
 *
 *      http://www.transcriptome.ens.fr/eoulsan
 *
 */
-->
<document> 

  <properties>
    <title>Design file</title>
    <author email="jourdren@biologie.ens.fr">Laurent Jourdren</author> 
  </properties> 



  <body>
  
    <section name="Design file">

      <p>The design file is the main element of the pipeline. It contains all informations and descriptions of the experiment. 
      It is a simple tabuled plain text file inspired by limma design file. Usualy the design file is named <b>design.txt</b>.
      Here is a sample of design file:</p>
      
<source>
SampleNumber	Name	Reads	Genome	Annotation	FastqFormat	Condition	RepTechGroup	Experiment Reference
1	s1	s1.fq	mouse_build37.fasta	mouse_build37.gff	fastq-illumina	c1	repT1	Experiment1	true
2	s2	s2.fq	mouse_build37.fasta	mouse_build37.gff	fastq-illumina	c2	repT2	Experiment1	false
3	s3	s3.fq	mouse_build37.fasta	mouse_build37.gff	fastq-illumina	c1	repT3	Experiment2	false
4	s4	s4.fq	mouse_build37.fasta	mouse_build37.gff	fastq-illumina	c2	repT3	Experiment2	false
</source>

	<p>In a design file 3 fields are mandatory:</p>
	<ul>
		<li><b>SampleNumber</b>: Numeric, must be unique and >0</li>
		<li><b>Name</b>: Name of the sample. Must be unique</li>
		<li><b>Reads</b>: Path to the reads data file. For backward compatibility with Eoulsan 1.0.x, this field can also be named <b>FileName</b>.</li>
	</ul>

	<p>User can add any additional field in this file. Some of the optional field are currently used in Eoulsan:</p>
	<ul>
		<li><b>Genome</b>: Path to genome file in fasta format</li>
		<li><b>Annotation</b>: Path to annotation file of the genome in GFF3 format</li>
		<li><b>Condition</b>: Condition for the sample in the experiment</li>
		<li><b>FastqFormat</b>: Fastq format. Currently Eoulsan 4 formats: fastq-sanger (default), fastq-solexa, fastq-illumina and fastq-illumina-1.5. See <a href="http://www.ncbi.nlm.nih.gov/pubmed/20015970">Cock et al</a> for more information about the various fastq formats.</li>
		<li><b>RepTechGroup</b>: Technical replicates group. Use to pool reads counts between technical replicates in differential analysis step.</li>
		<li><b>Experiment</b>: The name of the different experiments. Each experiment is analyzed separately. This field is also used to name plots and output files of differential analysis.</li>
		<li><b>Reference</b>: A boolean field. If this field is present a kinetic differential analysis.
		Sample with true value are consider as reference. Actually, this is the condition that is consider as reference and there must be only 1 sample of the condition marked as true.</li>
		<li><b>UUID</b>: Universal Unique Identifier of the sample. This field is generated by Eouslan createdesign command. In obfuscated design files, this value does not change.</li>
	</ul>
	
	<p>All paths in the design file can be URL and compressed files in gzip (.gz) or bzip2 (.bz2) are handled by Eoulsan.</p>
	<p><b>Note</b>: For some fields like genome or annotation, only one unique value is allowed for all the samples of the design file.</p>

		<subsection name="Paired-end support">
		
			<p>Paired-end files of a sample can be set between bracket and must be separated by a coma. The following design file show a example of design file with paired-end files:</p>
<source>
SampleNumber    Name    Reads   Genome  Annotation      FastqFormat     Condition       ReplicateType   UUID
1	s1	[s1a.fq.bz2,s1b.fq.bz2]	genome.fasta	annotation_only.gff	fastq-sanger	s1	B	705d190c-de47-4c4f-8ddf-881c9b89ca66
2	s2	[s2a.fq.bz2,s2b.fq.bz2]	genome.fasta	annotation_only.gff	fastq-sanger	s2	B	54c8833f-77e1-4e4f-90c2-742e459df7a7
</source>

		    <p><b><u>Warning :</u></b> This feature in experimental in Eoulsan 1.1. Only the <b>filterreads</b> and some mappers in <b>mapreads</b> steps 
		    in local mode can handle paired-end files.</p>
		</subsection>
 
		<subsection name="Repository for genomes and annotation">
		
			<p>To avoid duplication of genome and annotation files, Eoulsan can access to repositories dedicated to for this types of data.
			To access to this repositories, Eoulsan support two protocols : <b>genome</b> and <b>annotation</b>.
			See the <a href="datarepositories.html">data repository</a> to see how define repositories.
			Here are few example of design file using <b>genome</b> and <b>annotation</b> protocols:</p>

<source>
SampleNumber	Name	Reads	Genome	Annotation	FastqFormat	Condition	RepTechGroup	Experiment
1	s1	s1.fq	genome://mouse	annotation://mouse	fastq-illumina	c1	repT1	project1	
12	s2	s2.fq	genome://mouse	annotation://mouse	fastq-illumina	c1	repT1	project1
3	s3	s3.fq	genome://mouse	annotation://mouse	fastq-illumina	c1	repT2	project1
54	s4	s4.fq	genome://mouse	annotation://mouse	fastq-illumina	c1	repT2	project1
15	s1	s1.fq	genome://mouse	annotation://mouse	fastq-illumina	c2	repT3	project1	
5	s2	s2.fq	genome://mouse	annotation://mouse	fastq-illumina	c2	repT4	project1
25	s3	s3.fq	genome://mouse	annotation://mouse	fastq-illumina	c2	repT3	project1
13	s4	s4.fq	genome://mouse	annotation://mouse	fastq-illumina	c2	repT3	project1
</source>
			 
		</subsection>
		
		<subsection name="Technical replicates handling">
		
			<p>To handle replicates, the RepTechGroup fieldhave been add to the 
			design file. Here is an example of a design file using RepTechGroup 
			field:</p>
			
<source>
SampleNumber	Name	Reads	Genome	Annotation	FastqFormat	Condition	RepTechGroup	Experiment
1	s1	s1.fq	genome://mouse	annotation://mouse	fastq-illumina	c1	repT1	project1	
12	s2	s2.fq	genome://mouse	annotation://mouse	fastq-illumina	c1	repT1	project1
3	s3	s3.fq	genome://mouse	annotation://mouse	fastq-illumina	c1	repT2	project1
54	s4	s4.fq	genome://mouse	annotation://mouse	fastq-illumina	c1	repT2	project1
15	s1	s1.fq	genome://mouse	annotation://mouse	fastq-illumina	c2	na	project1	
5	s2	s2.fq	genome://mouse	annotation://mouse	fastq-illumina	c2	NA	project1
25	s3	s3.fq	genome://mouse	annotation://mouse	fastq-illumina	c2	repT3	project1
13	s4	s4.fq	genome://mouse	annotation://mouse	fastq-illumina	c2	repT3	project1
</source>
			<p>In this example below there is three technical replicates groups. For
			all sample with the same RepTechGroup value, reads counts are pooled. 
			Sample with na, NA, Na or nA value aren't pooled.</p>
			
			<p>For experiments without technicals replicates, all RepTechGroup 
			fields must have a na value. Here is an example:</p>
			
<source>
SampleNumber	Name	Reads	Genome	Annotation	FastqFormat	Condition	RepTechGroup	Experiment
1	s1	s1.fq	genome://mouse	annotation://mouse	fastq-illumina	c1	na	project1	
12	s2	s2.fq	genome://mouse	annotation://mouse	fastq-illumina	c1	Na	project1
3	s3	s3.fq	genome://mouse	annotation://mouse	fastq-illumina	c1	na	project1
54	s4	s4.fq	genome://mouse	annotation://mouse	fastq-illumina	c1	NA	project1
15	s1	s1.fq	genome://mouse	annotation://mouse	fastq-illumina	c2	na	project1	
5	s2	s2.fq	genome://mouse	annotation://mouse	fastq-illumina	c2	NA	project1
25	s3	s3.fq	genome://mouse	annotation://mouse	fastq-illumina	c2	na	project1
13	s4	s4.fq	genome://mouse	annotation://mouse	fastq-illumina	c2	NA	project1
</source> 	
			
		</subsection>
		
		<subsection name="Multiple experiments">
		
		One design file can describe the design of multiple differential analysis 
		experiments. This case is
		possible only by inputing several differents values in Experiment field. 
		
		Example :
		
<source>
SampleNumber	Name	Reads	Genome	Annotation	FastqFormat	Condition	RepTechGroup	Experiment
1	s1	s1.fq	genome://mouse	annotation://mouse	fastq-illumina	c1	repT1	project1	
12	s2	s2.fq	genome://mouse	annotation://mouse	fastq-illumina	c1	repT1	project1
3	s3	s3.fq	genome://mouse	annotation://mouse	fastq-illumina	c2	repT2	project1
54	s4	s4.fq	genome://mouse	annotation://mouse	fastq-illumina	c2	repT2	project1
15	s1	s1.fq	genome://mouse	annotation://mouse	fastq-illumina	c3	repT3	project2	
5	s2	s2.fq	genome://mouse	annotation://mouse	fastq-illumina	c3	repT3	project2
25	s3	s3.fq	genome://mouse	annotation://mouse	fastq-illumina	c4	repT4	project2
13	s4	s4.fq	genome://mouse	annotation://mouse	fastq-illumina	c4	repT4	project2
</source>
		
		</subsection>
		
		<subsection name="Kinetic differential analysis">
		
		Some RNA-seq experiments are kinetic that means in differential analysis, 
		all condition have to be compare only with a reference condition.
		This is handle by the Reference field : <b>One</b> sample of the reference condition
		must have true value in Reference field.
		
		Example :
		
<source>
SampleNumber	Name	Reads	Genome	Annotation	FastqFormat	Condition	RepTechGroup	Experiment	Reference
1	s1	s1.fq	genome://mouse	annotation://mouse	fastq-illumina	c1	repT1	project1	true
12	s2	s2.fq	genome://mouse	annotation://mouse	fastq-illumina	c1	repT1	project1	false
3	s3	s3.fq	genome://mouse	annotation://mouse	fastq-illumina	c2	repT2	project1	false
54	s4	s4.fq	genome://mouse	annotation://mouse	fastq-illumina	c2	repT2	project1	false
15	s1	s1.fq	genome://mouse	annotation://mouse	fastq-illumina	c3	repT3	project2	true
5	s2	s2.fq	genome://mouse	annotation://mouse	fastq-illumina	c3	repT3	project2	false
25	s3	s3.fq	genome://mouse	annotation://mouse	fastq-illumina	c4	repT4	project2	false
13	s4	s4.fq	genome://mouse	annotation://mouse	fastq-illumina	c4	repT4	project2	false
</source>

		<b>WARNING</b>: currently it is not possible to describe a kinetic experiment and a not
		kinetic experiment in the same design file. 	
		
		</subsection>

    </section>

  </body>
  
</document>
